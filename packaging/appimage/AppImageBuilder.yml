version: 1
script:
  - rm -rf AppDir || true
  - mkdir -p AppDir/usr/bin
  - mkdir -p AppDir/usr/share/applications
  - mkdir -p AppDir/usr/share/icons/hicolor/256x256/apps
  - mkdir -p AppDir/usr/share/metainfo
  - mkdir -p AppDir/usr/share/gosh-fetch/qml
  - cp ../../target/release/gosh-fetch-qt AppDir/usr/bin/
  - cp ../../gosh-fetch.desktop AppDir/usr/share/applications/io.github.gosh.Fetch.desktop
  - cp ../../resources/io.github.gosh.Fetch.png AppDir/usr/share/icons/hicolor/256x256/apps/
  - cp ../../io.github.gosh.Fetch.metainfo.xml AppDir/usr/share/metainfo/
  - cp ../../crates/gosh-fetch-qt/qml/Main.qml AppDir/usr/share/gosh-fetch/qml/

AppDir:
  path: ./AppDir

  app_info:
    id: io.github.gosh.Fetch
    name: Gosh Fetch
    icon: io.github.gosh.Fetch
    version: 2.1.0
    exec: usr/bin/gosh-fetch-qt
    exec_args: $@

  apt:
    arch: amd64
    sources:
      - sourceline: deb http://archive.ubuntu.com/ubuntu/ noble main universe
        key_url: http://keyserver.ubuntu.com/pks/lookup?op=get&search=0x871920D1991BC93C

    include:
      - qt6-base
      - qt6-base-plugins
      - qt6-declarative
      - qt6-declarative-plugins
      - libdbus-1-3

  test:
    fedora-30:
      image: appimagecrafters/tests-env:fedora-30
      command: ./AppRun
    debian-stable:
      image: appimagecrafters/tests-env:debian-stable
      command: ./AppRun
    ubuntu-focal:
      image: appimagecrafters/tests-env:ubuntu-focal
      command: ./AppRun

AppImage:
  arch: x86_64
  update-information: gh-releases-zsync|goshitsarch-eng|Gosh-Fetch-linux|latest|*x86_64.AppImage.zsync
